!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("experiment-js"),require("experiment-babylon-js"),require("lodash"),require("jQuery")):"function"==typeof define&&define.amd?define("task",["experiment-js","experiment-babylon-js","lodash","jQuery"],t):"object"==typeof exports?exports.task=t(require("experiment-js"),require("experiment-babylon-js"),require("lodash"),require("jQuery")):e.task=t(e.experiment,e.BABYLON,e._,e.jQuery)}(this,function(e,t,n,i){return function(e){function t(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=4)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var a=function(){function e(e,t){var n=[],i=!0,a=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){a=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(a)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=n(9),o=i(r),s=n(0),d=n(5),l=i(d);window.taskObject=null,window.calibrator=null;var u=new s.Deferred;if(document.addEventListener("DOMContentLoaded",function(){u.resolve()}),"undefined"!=typeof window){var c=document.getElementsByTagName("script");if(c.length){var g=c[c.length-1].src,f=g.indicesOf("/");window.assetsFolderFullpath=g.substr(0,f[f.length-2])}else window.assetsFolderFullpath="./"}var v=new s.RessourceManager;window.p1=u.promise,window.p2=v.addFiles(window.assetsFolderFullpath+"/assets/json/ressources.json");var p=["/assets/sprites/cross/squareSheetMargin.svg"],h=s.preloadImages.apply(void 0,p),m=a(h,2),b=m[0],w=m[1];Object.assign(window,{p3:b,preloadedImages:w}),window.loadingPromise=Promise.all([window.p1,window.p2,window.p3]),window.loadingPromise.then(function(){var e=new s.TaskObject((0,o.default)(".task-canvas"));e.assetsToLoad={adventurer:"/assets/sprites/adventurer/player.png"},e.registerSceneGenerator(l.default);var t=["loading","main"],n=["currentScene"],i={currentScene:t};e.paramBox.bind(e,n,i),e.startTask().then(function(n){(0,s.debuglog)(n),e.paramBox.bind(e,"currentScene",i),1!==t.length&&void 0!==e.paramBox.queryString.currentScene||(e.currentScene="main")}),window.taskObject=e})},function(e,t,n){"use strict";"undefined"!=typeof window&&n(3)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={sceneKey:"main",canvasBackground:new l.default.Color4(0,0,0,1),backgroundRoundRadius:0,clearColor:new l.default.Color4(0,0,0,1),canvasPercentWidth:1,canvasPercentHeight:1,mode:"central"};e=s.default.extend(t,e);var n=this.taskObject,i=n.create2DScene(e),a=i.stateManager,o=i.initialCanvas,d=n.R;i.onResize=[function(){(0,u.debuglog)("scene.onResize: this is a custom function to be called on resize events")}];var v=n.cloneAssetIntoScene(d.get.adventurer,i);v.hasAlpha=!0;var p=new l.default.Sprite2D(v,{parent:o,id:"adventurer",x:100,y:100,spriteSize:new l.default.Size(64,64),spriteLocation:new l.default.Vector2(0,128)}),h=setInterval(function(){if(o.isDisposed)return void clearInterval(h);21===p.spriteFrame?p.spriteFrame=0:p.spriteFrame+=1},40);p.opacity=0,a.set("elements2D",{adventurer:p}),a.register(f.drawTiles,f.addButton,f.disposeOfButtons);var m=this.dataManager,b=["id","subject_id","level","block"];m.addTable("mainSceneData",b);var w=["id","flag","happenedAt","handledAt","data"];m.addTable("mainSceneEvents",w),a.setGlobal("positionData",{indexOnTransitionSequence:-1,indexOnPredictionSequence:-1,fullSequenceIndex:-1}),a.setGlobal("hasSeenLearningInfo",!1),a.setGlobal("hasSeenPredictionInfo",!1),d.add({states:{running:"running",tutorial:"tutorial"},flags:{levelDefined:"levelDefined"},events:{sequenceGenerated:"sequenceGenerated",goNextPosition:"goNextPosition",startPrediction:"startPrediction",responseTimeEnded:"responseTimeEnded",isiAfterLearningEnded:"isiAfterLearningEnded",feedbackEnded:"feedbackEnded",isiAfterFeedbackEnded:"isiAfterFeedbackEnded",pauseTransition:"pauseTransition",predictionStartBlackout:"predictionStartBlackout",blackoutEnds:"blackoutEnds",predictionEndsBlackout:"predictionEndsBlackout",isiAfterPredictionEndsBlackout:"isiAfterPredictionEndsBlackout",screenWentBlack:"screenWentBlack",playPredictionSound:"playPredictionSound",playObservationSound:"playObservationSound",showModal:"showModal",goToTutorial:"goToTutorial",hasResponded:"hasResponded",restartTutorial:"restartTutorial",goToLevel1:"goToLevel1",goToLevel2:"goToLevel2",goToLevel3:"goToLevel3",goToLevel4:"goToLevel4"}});var x=a.addState(d.get.states_tutorial,d.get.states_running),P=r(x,2),y=P[0],k=P[1],T=a.states.pause,O=function(){var e=this.stateManager,t=e.get("elements2D"),n=e.get("GUI");n.levelVisible=!0,e.promise("disposeOfButtons");var i=new u.EventData(d.get.events_goToTutorial,e.timeInMs,{tutorial:1}),a={id:"levelOne",parent:n,text:"Level 1",marginAlignment:"h: center, v: bottom",margin:{rightPixels:330,topPixels:0},width:220,height:40,fill:l.default.Canvas2D.GetSolidColorBrush(new l.default.Color4(.8,.8,.8,1)),callbackFunction:null,fontName:"20pt Arial",baseOpacity:.8,hoverOpacity:1},r=s.default.extend(s.default.clone(a),{id:"buttonTutorialLevelFour",text:"Tutorial 1",margin:{rightPixels:330,bottomPixels:40},clickEventData:i});return e.promise("addButton",r).then(function(e){t.levelButtons=e;var n=!0,i=!1,a=void 0;try{for(var r,o=e[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){r.value.levelVisible=!0}}catch(e){i=!0,a=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw a}}return"stateManager.selectLevel: resolved"})};return a.states.active.addAwakeningFunctions(O),a.states.active.addEventFunctions(d.get.events_goToTutorial,function(e){var t=e.data.tutorial;a.setGlobal("currentTutorial",t),a.goToState(d.get.states_tutorial)}),k.addAwakeningFunctions(g.startRunning),k.addEventFunctions(d.get.events_goNextPosition,g.goToNextPosition),k.addEventFunctions(d.get.events_click,g.checkForClickPrediction),y.addAwakeningFunctions(c.awakeTutorial),y.addEventFunctions(d.get.events_modalDismissed,c.showNextPage),y.addEventFunctions(d.get.events_showModal,c.showModal),a.setPauseKeyStroke(),T.addAwakeningFunctions(O),T.addEndingFunctions(function(){this.stateManager.promise("disposeOfButtons")}),i}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){var n=[],i=!0,a=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){a=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(a)throw r}}return n}return function(t,n){if(u.Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.default=a;var o=n(2),s=i(o),d=n(1),l=i(d),u=n(0),c=n(8),g=n(7),f=n(6)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.disposeOfButtons=t.addButton=void 0;var a=n(2),r=i(a),o=n(1),s=i(o),d=n(0),l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(void 0===this.taskObject)throw new Error("stateManager.addButton: this.taskObject is undefined");var t=this.stateManager,n=t.get("elements2D").canvas,i={id:"button"+t.timeInMs,text:"text",x:50,y:50,width:100,height:50,fill:s.default.Canvas2D.GetSolidColorBrush(new s.default.Color4(.8,.8,.8,1)),clickEventData:null,fontName:"30pt Arial",baseOpacity:.8,hoverOpacity:1,zOrder:-.5,marginAlignment:null,fontSignedDistanceField:!0,margin:{},padding:{},parent:n};i.margin.leftPixels=0,i.margin.rightPixels=0,i.margin.topPixels=0,i.margin.bottomPixels=0,i.padding.leftPixels=0,i.padding.rightPixels=0,i.padding.topPixels=0,i.padding.bottomPixels=0,i.margin=r.default.extend(i.margin,e.margin),i.padding=r.default.extend(i.padding,e.padding),e.margin=i.margin,e.padding=i.padding,e=r.default.extend(i,e);var a={},o={},l={};null===e.marginAlignment?a={parent:e.parent,id:e.id,x:e.x,y:e.y,width:e.width,height:e.height,fill:e.fill,zOrder:e.zOrder,roundRadius:0,children:[new s.default.Text2D(e.text,{fontName:e.fontName,marginVAlignment:"v: center",fontSignedDistanceField:e.fontSignedDistanceField,marginHAlignment:3})]}:(a={parent:e.parent,id:e.id,width:e.width,height:e.height,fill:e.fill,zOrder:e.zOrder,marginAlignment:e.marginAlignment,roundRadius:0,children:[new s.default.Text2D(e.text,{fontName:e.fontName,marginVAlignment:"v: center",fontSignedDistanceField:e.fontSignedDistanceField,marginHAlignment:3})]},o=e.margin,l=e.padding);var u=new s.default.Rectangle2D(a);return u.opacity=e.baseOpacity,null!==o&&(u.margin.rightPixels=e.margin.rightPixels,u.margin.leftPixels=e.margin.leftPixels,u.margin.topPixels=e.margin.topPixels,u.margin.bottomPixels=e.margin.bottomPixels),null!==l&&(u.padding.rightPixels=l.rightPixels,u.padding.leftPixels=l.leftPixels,u.padding.topPixels=l.topPixels,u.padding.bottomPixels=l.bottomPixels),u.pointerEventObservable.add(function(){u.opacity=e.hoverOpacity},s.default.PrimitivePointerInfo.PointerOver),u.pointerEventObservable.add(function(){u.opacity=e.baseOpacity},s.default.PrimitivePointerInfo.PointerOut),null!==e.clickEventData&&e.clickEventData.constructor===d.EventData&&u.pointerEventObservable.add(function(){e.clickEventData.happenedAt=t.timeInMs,e.clickEventData.data.button=u,t.addEvent(e.clickEventData)},s.default.PrimitivePointerInfo.PointerUp),u},u=function(){var e=this.stateManager.get("elements2D");if(void 0!==e.levelButtons&&e.levelButtons.constructor===d.Array){for(var t=0;t<e.levelButtons.length;t++)e.levelButtons[t].dispose();e.levelButtons=[]}return"disposeOfButtons: buttons disposed."};t.addButton=l,t.disposeOfButtons=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.checkForClickPrediction=t.goToNextPosition=t.startRunning=void 0;var a=n(2),r=i(a),o=n(1),s=i(o),d=n(0),l=function(){var e=this.stateManager,t=e.R,n=this.stateManager.timeInMs+100,i=new d.EventData(t.get.events_goNextPosition,n,{belongsTo:["globalLog"],handledAt:null,storedAt:null});return e.addTimeTriggerEvent(i),"state.startRunning: resolved"},u=function(){var e=this.stateManager,t=e.get("elements2D");return t.adventurer.opacity=1,t.adventurer.x=r.default.random(50,this.taskObject.renderSize.width),t.adventurer.y=r.default.random(50,this.taskObject.renderSize.height),"Changed position"},c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,d.mandatory)();if(void 0===e.data.clientY)return(0,d.debugError)("state.checkForClickPrediction: event.data.clientY is undefined."),null;var t=this.stateManager,n=new s.default.Vector2(e.data.engineX,e.data.engineY),i=t.get("elements2D"),a=i.canvas.actualPosition,r=i.adventurer,o=new s.default.Vector2(r.width,r.height);return o.scaleInPlace(.5),function(e,t,n){return s.default.Vector2.DistanceSquared(e,t)<n.lengthSquared()}(n,r.actualPosition.add(o).add(a),o)&&t.newEvent(this.R.get.events_goNextPosition),"checkForClickPrediction resolved"};t.startRunning=l,t.goToNextPosition=u,t.checkForClickPrediction=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showModal=t.showNextPage=t.awakeTutorial=void 0;var i=n(0),a={title:{en:"This is the tutorial state"},content:{en:'\n    <h5>Welcome ! 👋🏽 😄 </h5>\n    This is modal, from the experiment-boxes module. <br>\n    If you click the button below, an "modal_dismissed" event will fire and trigger the next modal to appear<br><br>'}},r={title:{en:"😬"},content:{en:"How fun is that !<br>\n  Let's do another one ✌🏽😉 "}},o={title:{en:"There is no small examples"},content:{en:"<h5>Time to act</h5>\n    Try clicking on the little adventurer !\n    <br>"}},s={disclaimer:r,intro:a,trialInstruction:o},d=["intro","disclaimer","trialInstruction"],l=function(){this.stateManager.set("currentPage","intro");var e=new i.EventData(this.R.get.events_showModal,this.stateManager.timeInMs+100,{page:"intro"});this.stateManager.addTimeTriggerEvent(e)},u=function(e){var t=this,n=e.data.page,a=void 0===n?"intro":n;if(null!==this.taskObject.currentModal)try{this.taskObject.currentModal.modalBox.destroy()}catch(e){(0,i.debugWarn)(e)}(0,i.delay)(50).then(function(){if(s.hasOwnProperty(a)){var e=s[a],n=new i.EventData(t.R.get.events_modalDismissed,{page:a});t.taskObject.modal({type:"centralLarge",title:e.title.en,content:e.content.en,event:n})}})},c=function(e){var t=e.data.page,n=void 0===t?this.stateManager.get("currentPage","intro"):t,a=d,r=a.indexOf(n);if(-1===r)throw new Error("state.showNextPage: invalid currentPage.");if(r!==a.length-1){var o=new i.EventData(this.R.get.events_showModal,{page:a[r+1]});this.stateManager.addEvent(o)}else(0,i.debuglog)("state.showNextPage: end of tutorial."),this.stateManager.goToState(this.R.get.states_running,!0)};t.awakeTutorial=l,t.showNextPage=c,t.showModal=u},function(e,t){e.exports=i}])});